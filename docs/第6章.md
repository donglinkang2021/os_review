---
layout: default
title: 设备管理
nav_order: 第6章
---

# 第6章 设备管理

## 易错点整理

- SPOOLING技术
  - 全程：Simultaneous Peripheral Operation On-Line
  - 中文：外部设备联机并行操作
- 设备管理的主要功能
  - 设备分配
  - 控制I/O操作
  - 管理缓冲区
  - 实现虚拟设备技术

## 额外补充

- Spooling 系统在实现时所依赖的关键技术有：
  - 外存输入井和输出井管理技术
  - 内存输入缓冲区和输出缓冲区管理技术
  - 应设有专门的输入/输出进程，负责应用程序的I/O请求
  - 管理请求打印队列
- I/O软件的设计目标
  - 与具体设备无关
  - 统一命名
  - 对错误的处理
  - 缓冲技术
  - 设备的分配和释放
  - I/O控制方式

## 复习提纲


1. I/O设备通常大致可分为哪两大类？各自传输的信息单位有什么特点？ 

    ```markdown
    1. 字符设备
        - 人机交互设备
        - 是以字符为单位发送和接收数据的，通信速度比较慢
        - 键盘和显示器、鼠标、扫描仪、打印机、绘图仪等
    2. 块设备
        - 外部存储器
        - 以块为单位传输数据
        - 常见的块尺寸：`512KB ~ 32KB`
        - 磁盘、磁带、光盘等
    ```

2. 常用的四种数据传输方式。

    ```markdown
    1. 程序查询方式
        - 工作过程非常简单
        - 但CPU利用率低
        - 因为CPU执行指令的速度高出I/O设备的速度几个数量级，在循环测试中浪费了大量的CPU处理时间
        - CPU和I/O设备之间的相当于串行工作
    2. 中断方式
        - CPU一旦启动设备成功就转去执行其它程序
        - 当设备完成时向CPU发出中断请求
        - CPU执行完当前指令后，转去执行中断服务程序
        - 从而使得CPU和I/O设备之间的工作并行
    3. 直接存储器方式
        - 允许DMA控制器接管地址总线的控制权，直接控制控制器内部缓冲区与主存之间的数据交换
    4. 通道方式
        - 与DMA相比，通道所需要的cpu干预更少
        - 且可以做到一个通道干预多个设备
        - 进一步减轻了CPU的负担
        - 通道是一种专用的I/O处理器
            - 有自己的指令系统
            - 若干通道命令连接成通道程序
    ```

3. 根据设备的使用方式，设备被分为几种类型？何为虚拟设备？它是通过什么技术实现的？ *考过*

    ```markdown
    1. 三种类型
        - 独占设备
            - 一次只能被一个进程所使用，临界资源
            - 例如：打印机
        - 共享设备
            - 可以被多个进程共享
            - 例如：磁盘
        - 虚拟设备
            - 设备本身是独占设备，结果虚拟技术处理，可以把它改造成共享设备
    2. 虚拟设备
        - 通过Spooling技术实现
            - 利用**可共享磁盘的一部分空间**来模拟独占的I/O设备
            - 以空间换时间
        - 例如：打印机
            - 进程要打印时，系统并不为它分配打印机，
            - 而是把待打印的数据缓冲到一个独立的磁盘文件上，形成待打印文件队列。
            - 之后，Spooling系统一次一个地将打印队列上的文件送打印机打印。
            - 这种技术又叫缓输出技术。

    ```

4. 按照设备管理的层次结构，I/O软件划分为几层？各层主要实现哪些功能？ 

    ```markdown
    1. I/O硬件
    2. 中断处理程序
        - 进程在启动一个I/O操作后阻塞起来，I/O操作完成后，控制器产生一个中断
        - CPU响应中断，执行中断处理程序
        - 检查设备状态
            - 若正常完成，就唤醒等待的进程
                - 然后检查是否还有待处理的I/O请求 若有则启动
            - 若传输出错，再发命令重新传输
                - 或向上层报告错误  
        - 返回被中断的进程，或转进程调度
    3. 设备驱动程序
        - 是唯一知道设备控制器的配置情况
        - 一类设备对应一个驱动程序
        - 三部分功能
            - 初始化设备
            - 启动设备传输数据
            - 中断处理
    4. 设备独立性软件
        - 实现所有设备都需要的功能，且向用户提供一个统一的接口
        - 功能
            - 设备命名
            - 设备保护
            - 提供与设备无关的块尺寸
            - 缓冲技术
            - 负责设备分配和调度
            - 出错处理
    5. 用户层I/O软件
        - 大部分I/O软件都包含在操作系统中，有一小部分是由与用户程序连接在一起的库函数构成的。这些函数通常只是将系统调用所需要的参数放在合适的位置，由系统调用实现真正的操作。
    ```

    | I/O层次结构 | 
    | :---: |
    | 用户层I/O软件 |
    | 设备独立性软件 |
    | 设备驱动程序 |
    | 中断处理程序 |
    | 硬件 |

5. 何为设备的独立性？

    ```markdown
    设备独立性是指用户及用户程序不受系统配置的设备类型和具体设备的台号的影响。用户只是使用逻辑设备，具体的映射由操作系统完成。
    ```

6. 什么是SPOOLING技术？以输出为例，说明它的实现原理。（SPOOLING技术是以空间换时间）

    ```markdown
    1. SPOOLING技术
        - 假脱机技术
        - 利用可共享磁盘的一部分空间来模拟独占的I/O设备
        - 以空间换时间
    2. 以输出为例
        - 进程要打印时，系统并不为它分配打印机，
        - 而是把待打印的数据缓冲到一个独立的磁盘文件上，形成待打印文件队列。
        - 之后，Spooling系统一次一个地将打印队列上的文件送打印机打印。
        - 这种技术又叫缓输出技术。
    ```


7. 一个特定磁盘上的信息如何进行编址？

    ```markdown
    盘面号、磁道号 和扇区号（或柱面号、磁头号和扇区号）。
    ```

8. 要将磁盘上一个块的信息传输到主存需要系统花费哪些时间？

    ```markdown
    1. 寻道时间
    2. 旋转延迟时间
    3. 读/写传输时间
    ```

9. 常用的磁盘调度算法：先来先服务、最短寻道时间优先、扫描法（SCAN, C_SCAN, LOOK, C_LOOK）。

    ```markdown
    > 建议这里还是去看课本例子，非常好懂
    - `FCFS`
        - 先来先服务
        - 优点：简单
        - 缺点：平均寻道时间长
    - `SSTF`
        - 最短寻道时间优先
        - 优点：平均寻道时间短
        - 缺点：容易产生饥饿现象，磁臂黏着现象
    - `SCAN`
        - 扫描法、电梯调度算法
        - SSTF+固定方向
        - 需要到达最外道后或最内道后才能改变方向
    - `C_SCAN`
        - 循环扫描法
        - 只能向一个方向移动提供服务
        - 从最外道移动到最内道后，立即返回最外道，或者相反
    - `LOOK`
        - SCAN的变体
        - 不需要到达最外道或最内道才改变方向，到达最内或最外的请求即可改变方向
    - `C_LOOK`
        - C_SCAN的变体
        - 不需要到达最外道或最内道才改变方向，到达最内或最外的请求即可改变方向
    ```